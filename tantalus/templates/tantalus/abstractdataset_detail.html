{% extends "tantalus/base_view.html" %}
{% load staticfiles %}

{% block title %}
    Dataset Detail
{% endblock %}

{% block body %}
    <div class="container detail-container" style="padding-bottom: 1em; margin-bottom: 0.5em">
        {% if object %}
            <a class="btn btn-danger btn-sm" style="float:right; margin-top:5px;" href="{% url 'dataset-delete' pk=object.id %}">Delete dataset</a>
            <table class="table-condensed">
                <tr>
                    <th class="custom-table-header">Dataset Name</th>
                    <td class="custom-table-detail">{{object.name}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Dataset Type</th>
                    <td class="custom-table-detail">{{object.dataset_type}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Sample ID</th>
                    <td class="custom-table-detail"><a href="{% url 'sample-detail' object.sample.id %}">{{object.sample}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Library ID</th>
                    <td class="custom-table-detail">{{object.library.library_id}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Reference Genome</th>
                    <td class="custom-table-detail">{{object.reference_genome}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Aligner</th>
                    <td class="custom-table-detail">{{object.aligner}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Owner</th>
                    <td class="custom-table-detail">{{object.owner}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Last Updated</th>
                    <td class="custom-table-detail">{{object.last_updated}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Genome Region</th>
                    <td class="custom-table-detail">{{object.genome_region}}</td>
                </tr>
                <tr>
                    <th class="custom-table-header">Read End</th>
                    <td class="custom-table-detail">{{object.read_end}}</td>
                </tr>
            </table>
        {% else %}
            <h5><i class="text-warning">No Sequence Dataset Details yet.</i></h5>
        {% endif %}
    </div>

    <div class="container detail-bordered-container" style="border: solid 1px #E0E0E0; padding-bottom: 1em; margin-bottom: 0.5em">
        {% if object %}
            <h4>Lanes</h4>
            <div class="table-responsive">
                <table id="lane-datatable" class="table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Flowcell ID</th>
                            <th>Lane Number</th>
                            <th>DNA Library</th>
                            <th>Owner</th>
                            <th>Sequencing Center</th>
                            <th>Sequencing Instrument</th>
                            <th>Sequencing Library ID</th>
                            <th>Read Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        <br/>
                        {% for lane in object.sequence_lanes.all %}
                            <tr>
                                <td>{{lane.flowcell_id}}</td>
                                <td>{{lane.lane_number}}</td>
                                <td>{{lane.dna_library}}</td>
                                <td>{{lane.owner}}</td>
                                <td>{{lane.sequencing_center}}</td>
                                <td>{{lane.sequencing_instrument}}</td>
                                <td>{{lane.sequencing_library_id}}</td>
                                <td>{{lane.read_type}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <h5><i class="text-warning">No Lanes yet.</i></h5>
        {% endif %}
    </div>


    <div class="container detail-bordered-container" style="border: solid 1px #E0E0E0; padding-bottom: 1em; margin-bottom: 0.5em">
        {% if object %}
            <h4>File Resources</h4>
            <div class="table-responsive">
                <table id="file-resource-datatable" class="table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>File name</th>
                            <th>File Type</th>
                            <th>Index Sequence</th>
                            <th>Read End</th>
                            <th>Region</th>
                            <th>Size</th>
                            <th>Storage</th>
                            <th>Owner</th>
                        </tr>
                    </thead>
                    <tbody>
                        <br/>
                        {% for file in object.file_resources.all %}
                            <tr>
                                <td>{{file.filename}}</td>
                                <td>{{file.file_type.name}}</td>
                                <td>{{file.sequencefileinfo.index_sequence}}</td>
                                <td>{{file.sequencefileinfo.read_end}}</td>
                                <td>{{file.sequencefileinfo.genome_region}}</td>
                                <td>{{file.get_file_size}}</td>
                                <td>{{storages|join:", "}}</td>
                                <td>{{file.owner.username}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <h5><i class="text-warning">No file resources yet.</i></h5>
        {% endif %}
    </div>
{% endblock %}

{% block datatables_script %}
    <script type="text/javascript">
        $(document).ready(function() {
            $("#lane-datatable").DataTable({
                "order": [[0, "desc"]]
            });
            $("#file-resource-datatable").DataTable({
                "order": [[0, "desc"]]
            });
        });
    </script>
{% endblock %}